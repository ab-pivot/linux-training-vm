#!/bin/bash
set -ex

add-apt-repository ppa:neovim-ppa/unstable
apt-get update

apt-get install -y \
         \
        neovim \
        golang \
        git \
        tldr \
        python-dev \
        python-pip \
        python3-dev \
        python3-pip \
        build-essential \
         \
        gcc \
        libacl1-dev \
        libcap-dev \
        libcap-ng-utils \
        libseccomp-dev \
        libselinux1-dev \
        flex \
        bison \
        make \
        util-linux

pip3 --version
pip3 install neovim

#curl vimfiles.luan.sh/install | bash
if [ ! -d "/home/vagrant/vimfiles" ] ; then
  git clone https://github.com/luan/vimfiles.git /home/vagrant/vimfiles
  pushd /home/vagrant/vimfiles
    ./bin/install --non-interactive
  popd
fi

# Make GRUB pause during the boot, to give a chance to select custom boot configuration
sed -i 's/GRUB_TIMEOUT=0/GRUB_TIMEOUT=10/g' /etc/default/grub


if grep -e GOPATH /home/vagrant/.profile; then

  echo ".profile is already appended with user configuration"

else
  echo "Appending user configuration to .profile"

  cat <<-EOF >> /home/vagrant/.profile

# set user aliases

alias vi=nvim
EOF

fi

if grep -e GOPATH /home/vagrant/.bashrc; then

  echo ".bashrc is already appended with user configuration"

else
  echo "Appending user configuration to .bashrc"

  cat <<-EOF >> /home/vagrant/.bashrc

# set GOPATH

export GOPATH=/home/vagrant/workspace/go/

# set default editor

export EDITOR="$(which nvim)"
EOF

  mkdir /home/vagrant/workspace/go/

fi
